<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html><head></head><body>























    
    
    
    

  <div class="border-box-sizing">
    <div class="container">

<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1>Homework 3<a rel="noopener" class="anchor-link" href="#Homework-3">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4>Package Imports<a rel="noopener" class="anchor-link" href="#Package-Imports">&#182;</a></h4>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[111]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="k">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">cross_val_score</span><span class="p">,</span> <span class="n">cross_val_predict</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="k">import</span> <span class="n">StandardScaler</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="k">import</span> <span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">,</span> <span class="n">SGDRegressor</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="k">import</span> <span class="n">mean_squared_error</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">homogeneity_completeness_v_measure</span><span class="p">,</span> <span class="n">homogeneity_score</span>
<span class="kn">from</span> <span class="nn">sklearn.cross_validation</span> <span class="k">import</span> <span class="n">KFold</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="k">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="k">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.grid_search</span> <span class="k">import</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="k">import</span> <span class="n">feature_selection</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Problem 1<a rel="noopener" class="anchor-link" href="#Problem-1">&#182;</a></h2><p>For this problem you will experiment with linear regression models to make predictions with numerical data. You will
also explore more systematic methods for feature selection and for optimizing model parameters (model selection).
The data set you will use is a subset of the &quot;Communities and Crime&quot; data set that combines information from the
1990 census data as well as FBI crime data from 1995. Please read the full description of the data, including the
description and statistics on different variables. The target attribute for regression purposes is
&quot;ViolentCrimesPerPop&quot;. The two identifier attributes &quot;state&quot; and &quot;community name&quot; should be excluded for the
regression task.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Import data</span>
<span class="n">url</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;https://raw.githubusercontent.com/PixarJunkie/dsc478-programming-ml-applications/master/data/communities-data/communities.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 1a<a rel="noopener" class="anchor-link" href="#Problem-1a">&#182;</a></h3><p>Load and preprocess the data using Pandas or Numpy and, if necessary, preprocessing functions from
scikit-learn. The provided data is already normalized (see description), so there is no need for
additional normalization. Compute and display basic statistics (mean, standard deviation, min, max, etc.)
for each of the variables in the data set. Separate the target attribute for regression.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Remove ?</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">OtherPerCap</span> <span class="o">!=</span> <span class="s1">&#39;?&#39;</span><span class="p">]</span>
<span class="c1">#Seperate target variable and drop state/communityname</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ViolentCrimesPerPop</span>
<span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;ViolentCrimesPerPop&#39;</span><span class="p">,</span> <span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="s1">&#39;communityname&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Basic stats</span>
<span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>population</th>
      <th>householdsize</th>
      <th>racepctblack</th>
      <th>racePctWhite</th>
      <th>racePctAsian</th>
      <th>racePctHisp</th>
      <th>agePct12t21</th>
      <th>agePct12t29</th>
      <th>agePct16t24</th>
      <th>agePct65up</th>
      <th>...</th>
      <th>NumInShelters</th>
      <th>NumStreet</th>
      <th>PctForeignBorn</th>
      <th>PctBornSameState</th>
      <th>PctSameHouse85</th>
      <th>PctSameCity85</th>
      <th>PctSameState85</th>
      <th>LandArea</th>
      <th>PopDens</th>
      <th>PctUsePubTrans</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>...</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
      <td>1993.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.057612</td>
      <td>0.463437</td>
      <td>0.179227</td>
      <td>0.753984</td>
      <td>0.153753</td>
      <td>0.144089</td>
      <td>0.424210</td>
      <td>0.493914</td>
      <td>0.336297</td>
      <td>0.423086</td>
      <td>...</td>
      <td>0.029453</td>
      <td>0.022790</td>
      <td>0.215655</td>
      <td>0.608776</td>
      <td>0.534967</td>
      <td>0.626322</td>
      <td>0.651470</td>
      <td>0.065243</td>
      <td>0.232910</td>
      <td>0.161741</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.126935</td>
      <td>0.163747</td>
      <td>0.252870</td>
      <td>0.243807</td>
      <td>0.208905</td>
      <td>0.232531</td>
      <td>0.155234</td>
      <td>0.143584</td>
      <td>0.166540</td>
      <td>0.179196</td>
      <td>...</td>
      <td>0.102630</td>
      <td>0.100424</td>
      <td>0.231146</td>
      <td>0.204314</td>
      <td>0.181360</td>
      <td>0.200520</td>
      <td>0.198253</td>
      <td>0.109485</td>
      <td>0.203127</td>
      <td>0.229099</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.010000</td>
      <td>0.350000</td>
      <td>0.020000</td>
      <td>0.630000</td>
      <td>0.040000</td>
      <td>0.010000</td>
      <td>0.340000</td>
      <td>0.410000</td>
      <td>0.250000</td>
      <td>0.300000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.060000</td>
      <td>0.470000</td>
      <td>0.420000</td>
      <td>0.520000</td>
      <td>0.560000</td>
      <td>0.020000</td>
      <td>0.100000</td>
      <td>0.020000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.020000</td>
      <td>0.440000</td>
      <td>0.060000</td>
      <td>0.850000</td>
      <td>0.070000</td>
      <td>0.040000</td>
      <td>0.400000</td>
      <td>0.480000</td>
      <td>0.290000</td>
      <td>0.420000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.130000</td>
      <td>0.630000</td>
      <td>0.540000</td>
      <td>0.670000</td>
      <td>0.700000</td>
      <td>0.040000</td>
      <td>0.170000</td>
      <td>0.070000</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>0.050000</td>
      <td>0.540000</td>
      <td>0.230000</td>
      <td>0.940000</td>
      <td>0.170000</td>
      <td>0.160000</td>
      <td>0.470000</td>
      <td>0.540000</td>
      <td>0.360000</td>
      <td>0.530000</td>
      <td>...</td>
      <td>0.010000</td>
      <td>0.000000</td>
      <td>0.280000</td>
      <td>0.770000</td>
      <td>0.660000</td>
      <td>0.770000</td>
      <td>0.790000</td>
      <td>0.070000</td>
      <td>0.280000</td>
      <td>0.190000</td>
    </tr>
    <tr>
      <th>max</th>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
<p>8 rows &#215; 96 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Train test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_train shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;X_test shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_train shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;y_test shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>X_train shape: (1395, 97)
X_test shape: (598, 97)
y_train shape: (1395,)
y_test shape: (598,)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 1b<a rel="noopener" class="anchor-link" href="#Problem-1b">&#182;</a></h3><p>Perform standard linear regression on data using the implementation for Ch. 8 of MLA. Compute the
RMSE value on the full training data. Also, plot the correlation between the predicted and actual values of
the target attribute. Display the obtained regression coefficients (weights). Finally, perform 10-fold crossvalidation and compare the cross-validation RMSE to the training RMSE (for cross validation, you should
use the KFoldmodule from sklearn.cross_validation).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Base model</span>
<span class="n">reg</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="c1">#Fit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">train_preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="c1">#Training rmse</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training RMSE = &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">train_preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Regression coeff: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Training RMSE = 0.12706984575174946
Regression coeff: [ 0.18180384 -0.02456446  0.19336785 -0.0692231   0.02402757  0.10533693
  0.10651976 -0.28684654 -0.00450859  0.15568013 -0.34153117  0.05689896
 -0.31278512 -0.17418009  0.05200266 -0.20547294 -0.05745159  0.0418954
 -0.06378795  0.41571875  0.16334943 -0.35312853 -0.0255256  -0.04713248
  0.02572615  0.05822205  0.02050493  0.16697108 -0.18455236 -0.04589169
  0.04642044  0.05984499 -0.00723915  0.16686814 -0.01012395  0.00999885
  0.70361587  0.16266403  0.5734757  -1.13766631 -0.41501933 -0.01946235
 -0.19851608 -0.0338486  -0.0116426   0.05942284 -0.16889839 -0.20970299
  0.17295796 -0.1320901   0.02803919  0.05267064 -0.12199557  0.04132845
  0.01107641 -0.33486353  0.45899263 -0.11096538  0.0702354  -0.08814446
  0.23000182 -0.30240472  0.55610593  0.30003273 -0.31591065 -1.2280806
  0.15916502  0.05334984  0.02512211  0.22149232 -0.02516277  1.15062278
  0.02449627 -0.06814524 -0.05416636  0.01070542 -0.02373715 -0.38539679
  0.39428161 -0.11960818 -0.26154955  0.09102648 -0.02396149  0.28271551
 -0.00583818 -0.0416039  -0.03452352  0.1641573   0.12480197  0.08307837
 -0.03258087 -0.08831873  0.04827983  0.04442258  0.00529837 -0.01373551
 -0.03441289]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Training preds vs. actual</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.collections.PathCollection at 0x2a3a3dcab38&gt;</pre>
</div>

</div>

<div class="output_area">

    <div class="prompt"></div>




<div class="output_png output_subarea">
<img loading="lazy" src="javascript://"/>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Cross-validation</span>
<span class="n">cv_10f</span> <span class="o">=</span> <span class="n">cross_val_score</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cv scores: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cv_10f</span><span class="p">))</span>
<span class="c1">#Cross-validation preds</span>
<span class="n">cv_10f_preds</span> <span class="o">=</span> <span class="n">cross_val_predict</span><span class="p">(</span><span class="n">reg</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>cv scores: [0.66115654 0.67181177 0.59008449 0.6258997  0.63665183 0.61778658
 0.71202608 0.55823714 0.54092493 0.6308973 ]
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Cross-validation RMSE through mean_squared_error module</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X_train</span><span class="p">),</span> <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">x_val</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">test_ind</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">y_test</span>
    <span class="n">x_val</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_test</span><span class="p">))</span>
       
<span class="n">cv_10f_kf</span> <span class="o">=</span> <span class="n">x_val</span> <span class="o">/</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kf_MSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cv_10f_kf</span><span class="p">))</span>

<span class="c1">#Cross-validation RMSE through mean_squared_error module</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cv_mse RMSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">cv_10f_preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>kf_MSE: 0.13883607250349875
cv_mse RMSE: 0.13932669369452322
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 1c<a rel="noopener" class="anchor-link" href="#Problem-1c">&#182;</a></h3><p>Feature Selection: use the scikit-learn regression model from sklearn.linear_model with a subset
of features to perform linear regression. For feature selection, write a script or function that takes as input
the training data, target variable; the model; and any other parameters you find necessary, and returns the
optimal percentage of the most informative features to use. Your approach should use k-fold crossvalidation on the training data (you can use k=5). You can
use feature_selection.SelectPercentile to find the most informative variables. Show the list of
most informative variables and their weights Note: since this is regression not classification, you should
use feature_selection.f_regression as scoring function rather than chi2). Next, plot the model&#39;s mean
absolute error values on cross-validation relative to the percentage of selected features (See scikitlearn&#39;s metrics.mean_absolute_error). In order to use cross_validation.cross_val_score with
regression you&#39;ll need to pass to it scoring=&#39;mean_absolute_error&#39; as a parameter. Review scikitlearn documentation for feature selection</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">best_feats</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">model_</span><span class="p">):</span>
    <span class="n">opt_feats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">perc</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">SelectPercentile</span><span class="p">(</span><span class="n">feature_selection</span><span class="o">.</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">percentile</span> <span class="o">=</span> <span class="n">i</span><span class="p">)</span>
        <span class="n">train_fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">model_</span><span class="p">,</span> <span class="n">train_fs</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">opt_feats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opt_feats</span><span class="p">,</span> <span class="n">scores</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">opt_perc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">opt_feats</span> <span class="o">==</span> <span class="n">opt_feats</span><span class="o">.</span><span class="n">max</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">opt_num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">perc</span><span class="p">[</span><span class="n">opt_perc</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opt_perc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">opt_num</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Get perc and num for features</span>
<span class="n">best</span> <span class="o">=</span> <span class="n">best_feats</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span>

<span class="c1">#Fit opt_perc from best </span>
<span class="n">fs</span> <span class="o">=</span> <span class="n">feature_selection</span><span class="o">.</span><span class="n">SelectPercentile</span><span class="p">(</span><span class="n">feature_selection</span><span class="o">.</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">percentile</span> <span class="o">=</span> <span class="n">best</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">train_fs</span> <span class="o">=</span> <span class="n">fs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">scores</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">LinearRegression</span><span class="p">(),</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1">#Create new df with feature indexes</span>
<span class="n">cols</span> <span class="o">=</span> <span class="n">train_fs</span><span class="o">.</span><span class="n">get_support</span><span class="p">()</span>
<span class="n">col_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">cols</span><span class="p">])</span>
<span class="n">features_df_train</span> <span class="o">=</span> <span class="n">X_train</span><span class="p">[</span><span class="n">col_names</span><span class="p">]</span>
<span class="n">features_df_test</span> <span class="o">=</span> <span class="n">X_test</span><span class="p">[</span><span class="n">col_names</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#RSME with subset df on top featues</span>
<span class="c1">#Cross-validation RMSE through mean_squared_error module</span>
<span class="n">kf</span> <span class="o">=</span> <span class="n">KFold</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">features_df_train</span><span class="p">),</span> <span class="n">n_folds</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">x_val</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">train_ind</span><span class="p">,</span> <span class="n">test_ind</span> <span class="ow">in</span> <span class="n">kf</span><span class="p">:</span>
    <span class="n">reg</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">features_df_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
    <span class="n">pred</span> <span class="o">=</span> <span class="n">reg</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features_df_test</span><span class="p">)</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">pred</span> <span class="o">-</span> <span class="n">y_test</span>
    <span class="n">x_val</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">err</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">features_df_test</span><span class="p">))</span>
       
<span class="n">cv_10f_kf</span> <span class="o">=</span> <span class="n">x_val</span> <span class="o">/</span> <span class="mi">10</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;kf_MSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">cv_10f_kf</span><span class="p">))</span>

<span class="c1">#Cross-validation RMSE through mean_squared_error module</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cv_mse RMSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">cv_10f_preds</span><span class="p">,</span> <span class="n">y_train</span><span class="p">))))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>kf_MSE: 0.1414994701879717
cv_mse RMSE: 0.13932669369452322
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 1d<a rel="noopener" class="anchor-link" href="#Problem-1d">&#182;</a></h3><p>Next, perform Ridge Regression and Lasso Regression using the modules
from sklearn.linear_model. In each case, perform systematic model selection to identify the
optimal alpha parameter. First, create a 20%-80% randomized split of the data. Set aside the test portion;
the model selection process should be performed using the 80% training data partition. You should create a
function that takes as input the data and target variable; the parameter to vary and a list of its values; the
model to be trained; and any other relevant input needed to determine the optimal value for the specified
parameter. The model selection process should perform k-fold cross validation (k should be a parameter, 
but you can select k=5 for this problem). You should also plot the error values on the training and crossvalidation splits across the specified values of the alphaparameter. Finally, using the best alpha value,
run the model on the set-aside test data. Discuss your observation and conclusions.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[86]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Ridge regression (using the same train/test data from the prior parts)</span>
<span class="k">def</span> <span class="nf">ridge_lasso</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">model_</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">param_range</span><span class="p">):</span>
    <span class="c1">#Ridge</span>
    <span class="k">if</span> <span class="n">model_</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#Test params in param_range</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">param_range</span><span class="p">:</span>
            <span class="c1">#Base model</span>
            <span class="n">rr</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">num</span><span class="p">)</span>
            <span class="c1">#Cv with scores</span>
            <span class="n">rr_cv_scores</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">))</span>
            <span class="c1">#Add to results</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">num</span><span class="p">,</span> <span class="n">rr_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="c1">#Replace results with better cv score</span>
            <span class="k">elif</span> <span class="n">rr_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">,</span> <span class="n">rr_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="n">best_rr</span> <span class="o">=</span> <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">best_rr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    
    <span class="c1">#Lasso</span>
    <span class="k">if</span> <span class="n">model_</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1">#Test params in param_range</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">param_range</span><span class="p">:</span>
            <span class="c1">#Base model</span>
            <span class="n">lm</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">num</span><span class="p">)</span>
            <span class="c1">#Cv with scores</span>
            <span class="n">lm_cv_scores</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">cross_val_score</span><span class="p">(</span><span class="n">lm</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">scoring</span> <span class="o">=</span> <span class="s1">&#39;mean_absolute_error&#39;</span><span class="p">,</span> <span class="n">cv</span> <span class="o">=</span> <span class="mi">5</span><span class="p">))</span>
            <span class="c1">#Add to results</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">num</span><span class="p">,</span> <span class="n">lm_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
            <span class="c1">#Replace results with better cv score</span>
            <span class="k">elif</span> <span class="n">lm_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">results</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span><span class="p">,</span> <span class="n">lm_cv_scores</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
        <span class="n">best_lm</span> <span class="o">=</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">best_model</span> <span class="o">=</span> <span class="n">best_lm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="c1">#Return model</span>
    <span class="k">return</span> <span class="n">best_model</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[87]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Ridge model and RMSE</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ridge_lasso</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;aplha&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

<span class="c1">#Lasso model and RMSE</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">ridge_lasso</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;aplha&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)))</span>
<span class="n">preds</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">preds</span><span class="p">,</span> <span class="n">y_test</span><span class="p">))))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>[0.1, 0.1036798487480546]
RMSE: 0.13753920468232295
 
[0.1, 0.18164229005279992]
RMSE: 0.24213965360863646
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5>Discussion<a rel="noopener" class="anchor-link" href="#Discussion">&#182;</a></h5><p>From looking at the RMSE between the two models it appears that Lasso performs better in this case. I would also look into the accuracy, percision, and AUC curves of both models before making the final decision. I was surprised to see that in both cases the best alpha was the one that had the best cv score.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4>Problem 1e<a rel="noopener" class="anchor-link" href="#Problem-1e">&#182;</a></h4><p>Next, perform regression using Stochastic Gradient Descent for regression. For this part, you should use
the SGDRegessor module from sklearn.linear_model. Again, start by a creating randomized 80%-
20% train-test split. SGDRegessor requires that features be standardized (with 0 mean and scaled by
standard deviation). Prior to fiting the model, perform the scaling
using StandardScaler from sklearn.preprocessing. For this problem, perform a grid search
(using GridSearchCV from sklearn.grid_search) Your grid search should compare combinations of
two penalty parameters (&#39;l2&#39;, &#39;l1&#39;) and different values of alpha (alpha could vary from 0.0001 which is the
default to relatively large values, say 10). Using the best parameters, apply the model to the set-aside test
data. Finally, perform model selection (similar to part d, above) to find the best &quot;l1_ratio&quot; parameter using
SGDRegressor with the &quot;elasticnet&quot; penalty parameter. Note: &quot;l1_ratio&quot; is The Elastic Net mixing
parameter, with 0 &lt;= l1_ratio &lt;= 1; l1_ratio=0 corresponds to L2 penalty, l1_ratio=1 to L1 penalty; defaults
to 0.15. Using the best mixing ratio, apply the Elastic Net model to the set-aside test data. Provide a
summary of your findings from the above experiments.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[111]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Scale data</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_train_fit</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_fit</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1">#params for gridsearch</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;l1&#39;</span><span class="p">],</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">]}</span>
<span class="c1">#Base SGD model</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SGDRegressor</span><span class="p">()</span>
<span class="c1">#Gridsearch model</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
<span class="c1">#Fit gs to X_train_fit</span>
<span class="n">gs_model</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_fit</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Predict X_test_fit gs to test data</span>
<span class="n">gs_preds</span> <span class="o">=</span> <span class="n">gs_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_fit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">gs_preds</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>

<span class="c1">##params for gridsearch</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;penalty&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;l1&#39;</span><span class="p">],</span> <span class="s1">&#39;alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="s1">&#39;l1_ratio&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))}</span>
<span class="n">sgd</span> <span class="o">=</span> <span class="n">SGDRegressor</span><span class="p">()</span>
<span class="c1">#Gridsearch model</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">sgd</span><span class="p">,</span> <span class="n">param_grid</span> <span class="o">=</span> <span class="n">params</span><span class="p">)</span>
<span class="c1">#Fit gs to X_train_fit</span>
<span class="n">gs_model</span> <span class="o">=</span> <span class="n">gs</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_fit</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1">#Predict X_test_fit gs to test data</span>
<span class="n">gs_preds</span> <span class="o">=</span> <span class="n">gs_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_fit</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">gs</span><span class="o">.</span><span class="n">best_params_</span><span class="p">,</span> <span class="n">gs</span><span class="o">.</span><span class="n">best_score_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">gs_preds</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>{&#39;alpha&#39;: 0.0001, &#39;penalty&#39;: &#39;l1&#39;} 0.6202439592221028
RMSE 0.019189902116753508
 
{&#39;alpha&#39;: 0.0001, &#39;l1_ratio&#39;: 0.7157894736842105, &#39;penalty&#39;: &#39;l1&#39;} 0.6217674459250742
RMSE 0.02162733245999105
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5>Discussion<a rel="noopener" class="anchor-link" href="#Discussion">&#182;</a></h5><p>There doesn&#39;t appear to be much of a difference when varying the &#39;l1_ratio&#39; and leaving it at the default 0.15. In fact, the best scores between the two best scores was trivial.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2>Problem 2<a rel="noopener" class="anchor-link" href="#Problem-2">&#182;</a></h2><p>For this problem you will use a different subset of the 20 Newsgroup data set that you used in Assignment 2 (see
the description of the full dataset). The subset for this assignment includes 2,500 documents (newsgroup posts),
each belonging to one of 5 categories windows (0), crypt (1), christian (2), hockey (3), forsale (4). The
documents are represented by 9328 terms (stems). The dictionary (vocabulary) for the data set is given in the file
&quot;terms.txt&quot; and the full term-by-document matrix is given in &quot;matrix.txt&quot; (comma separated values). The actual
category labels for the documents are provided in the file &quot;classes.txt&quot;. Your goal in this assignment is to perform
clustering on the documents and compare the clusters to the actual categories.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Import data</span>
<span class="n">doc_classes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://raw.githubusercontent.com/PixarJunkie/dsc478-programming-ml-applications/master/data/news-groups-data/classes.txt&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;doc_class&#39;</span><span class="p">])</span>
<span class="n">doc_classes</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">inplace</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">doc_classes</span> <span class="o">=</span> <span class="n">doc_classes</span><span class="o">.</span><span class="n">doc_class</span><span class="o">.</span><span class="n">values</span>
<span class="n">term_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://raw.githubusercontent.com/PixarJunkie/dsc478-programming-ml-applications/master/data/news-groups-data/matrix.txt&#39;</span><span class="p">,</span> <span class="n">delimiter</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span>
<span class="n">terms</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://raw.githubusercontent.com/PixarJunkie/dsc478-programming-ml-applications/master/data/news-groups-data/terms.txt&#39;</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;term&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 2a<a rel="noopener" class="anchor-link" href="#Problem-2a">&#182;</a></h3><p>Create your own distance function that, instead of using Euclidean distance, uses Cosine similarity.
This is the distance function you will use to pass to the kMeans function.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Cosine similarity</span>
<span class="k">def</span> <span class="nf">cos_sim</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 2b<a rel="noopener" class="anchor-link" href="#Problem-2b">&#182;</a></h3><p>Load the data set Note: the data matrix provided has terms as rows and documents as columns.
Since you will be clustering documents, you&#39;ll need to take the transpose of this matrix so that your main
data matrix is a document x term matrix. In Numpy, you may use the &quot;.T&quot; operation to obtain the
transpose. Then, split the data set (the document x term matrix) and set aside 20% for later use (see
below). Use the 80% segment for clustering in the next part. The 20% portion must be a random subset.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Transpose term_matrix</span>
<span class="n">term_matrix_t</span> <span class="o">=</span> <span class="n">term_matrix</span><span class="o">.</span><span class="n">T</span>

<span class="c1">#Train test split</span>
<span class="n">terms_train</span><span class="p">,</span> <span class="n">terms_test</span><span class="p">,</span> <span class="n">label_train</span><span class="p">,</span> <span class="n">label_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">term_matrix_t</span><span class="p">,</span> <span class="n">doc_classes</span><span class="p">,</span> <span class="n">test_size</span> <span class="o">=</span> <span class="mf">0.20</span><span class="p">,</span> <span class="n">random_state</span> <span class="o">=</span> <span class="mi">23</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;terms_train shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">terms_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;terms_test shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">terms_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;label_train shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_train</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;label_test shape: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label_test</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>terms_train shape: (2000, 9328)
terms_test shape: (500, 9328)
label_train shape: (2000,)
label_test shape: (500,)
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3>Problem 2c<a rel="noopener" class="anchor-link" href="#Problem-2c">&#182;</a></h3><p>Perform Kmeans clustering on the training data. Write a function to display the top N terms in each
cluster along with the cluster DF values for each term and the size of the cluster. The cluster DF value
for a term t in a cluster C is the percentage of docs in cluster C in which term t appears (so, if a cluster
has 500 documents, and term &quot;game&quot; appears in 100 of those 500 documents, then DF value of &quot;game&quot;
in that cluster is 0.2 or 20%). Sort the terms for each cluster in decreasing order of the DF percentage.
Here is an example of how this output might look like (here the top 10 terms for 3 of the 5 clusters
are displayed in decreasing order of cluster DF values, but the mean frequnecy from the cluster centroid
is also shown). Extra Credit: use your favorite third party tool, ideally with a Python based API, to
create a word cloud for each cluster.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">randCent</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
	<span class="n">centroids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">n</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="c1">#create random cluster centers</span>
		<span class="n">minJ</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dataSet</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span>
		<span class="n">rangeJ</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">dataSet</span><span class="p">[:,</span><span class="n">j</span><span class="p">])</span> <span class="o">-</span> <span class="n">minJ</span><span class="p">)</span>
		<span class="n">centroids</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">minJ</span> <span class="o">+</span> <span class="n">rangeJ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">centroids</span> 

<span class="k">def</span> <span class="nf">kMeans</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">distMeas</span><span class="o">=</span><span class="n">cos_sim</span><span class="p">,</span> <span class="n">createCent</span><span class="o">=</span><span class="n">randCent</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">clusterAssment</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="c1">#create mat to assign data points </span>
                                      <span class="c1">#to a centroid, also holds SE of each point</span>
    <span class="n">centroids</span> <span class="o">=</span> <span class="n">createCent</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
    <span class="n">clusterChanged</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="n">clusterChanged</span><span class="p">:</span>
        <span class="n">clusterChanged</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span><span class="c1">#for each data point assign it to the closest centroid</span>
            <span class="n">minDist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">;</span> <span class="n">minIndex</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                <span class="n">distJI</span> <span class="o">=</span> <span class="n">distMeas</span><span class="p">(</span><span class="n">centroids</span><span class="p">[</span><span class="n">j</span><span class="p">,:],</span><span class="n">dataSet</span><span class="p">[</span><span class="n">i</span><span class="p">,:])</span>
                <span class="k">if</span> <span class="n">distJI</span> <span class="o">&lt;</span> <span class="n">minDist</span><span class="p">:</span>
                    <span class="n">minDist</span> <span class="o">=</span> <span class="n">distJI</span><span class="p">;</span> <span class="n">minIndex</span> <span class="o">=</span> <span class="n">j</span>
            <span class="k">if</span> <span class="n">clusterAssment</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">minIndex</span><span class="p">:</span> <span class="n">clusterChanged</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">clusterAssment</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">minIndex</span><span class="p">,</span><span class="n">minDist</span><span class="o">**</span><span class="mi">2</span>
        <span class="c1"># print centroids</span>
        <span class="k">for</span> <span class="n">cent</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">):</span><span class="c1">#recalculate centroids</span>
            <span class="n">ptsInClust</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">clusterAssment</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">cent</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span> <span class="c1">#get all the point in this cluster - Note: this was incorrect in the original distribution.</span>
            <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ptsInClust</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">):</span>
                <span class="n">centroids</span><span class="p">[</span><span class="n">cent</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">ptsInClust</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1">#assign centroid to mean - Note condition was added 10/28/2013</span>
    <span class="k">return</span> <span class="n">centroids</span><span class="p">,</span> <span class="n">clusterAssment</span>

<span class="k">def</span> <span class="nf">biKmeans</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">distMeas</span><span class="o">=</span><span class="n">cos_sim</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">dataSet</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">clusterAssment</span> <span class="o">=</span> <span class="n">mat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">m</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">centroid0</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">dataSet</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">centList</span> <span class="o">=</span><span class="p">[</span><span class="n">centroid0</span><span class="p">]</span> <span class="c1">#create a list with one centroid</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">m</span><span class="p">):</span> <span class="c1">#calc initial Error</span>
        <span class="n">clusterAssment</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">distMeas</span><span class="p">(</span><span class="n">mat</span><span class="p">(</span><span class="n">centroid0</span><span class="p">),</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">j</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centList</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">k</span><span class="p">):</span>
        <span class="n">lowestSSE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">centList</span><span class="p">)):</span>
            <span class="n">ptsInCurrCluster</span> <span class="o">=</span> <span class="n">dataSet</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">clusterAssment</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="o">==</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span> <span class="c1">#get the data points currently in cluster i</span>
            <span class="n">centroidMat</span><span class="p">,</span> <span class="n">splitClustAss</span> <span class="o">=</span> <span class="n">kMeans</span><span class="p">(</span><span class="n">ptsInCurrCluster</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">distMeas</span><span class="p">)</span>
            <span class="n">sseSplit</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">splitClustAss</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="c1">#compare the SSE to the currrent minimum</span>
            <span class="n">sseNotSplit</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">clusterAssment</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">clusterAssment</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">A</span><span class="o">!=</span><span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="mi">1</span><span class="p">])</span>
            <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;sseSplit, and notSplit: &quot;</span><span class="p">,</span><span class="n">sseSplit</span><span class="p">,</span><span class="n">sseNotSplit</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">sseSplit</span> <span class="o">+</span> <span class="n">sseNotSplit</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">lowestSSE</span><span class="p">:</span>
                <span class="n">bestCentToSplit</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">bestNewCents</span> <span class="o">=</span> <span class="n">centroidMat</span>
                <span class="n">bestClustAss</span> <span class="o">=</span> <span class="n">splitClustAss</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="n">lowestSSE</span> <span class="o">=</span> <span class="n">sseSplit</span> <span class="o">+</span> <span class="n">sseNotSplit</span>
        <span class="n">bestClustAss</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">bestClustAss</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">centList</span><span class="p">)</span> <span class="c1">#change 1 to 3,4, or whatever</span>
        <span class="n">bestClustAss</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">bestClustAss</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestCentToSplit</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;the bestCentToSplit is: &#39;</span><span class="p">,</span><span class="n">bestCentToSplit</span><span class="p">)</span>
        <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;the len of bestClustAss is: &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">bestClustAss</span><span class="p">))</span>
        <span class="n">centList</span><span class="p">[</span><span class="n">bestCentToSplit</span><span class="p">]</span> <span class="o">=</span> <span class="n">bestNewCents</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="c1">#replace a centroid with two best centroids </span>
        <span class="n">centList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bestNewCents</span><span class="p">[</span><span class="mi">1</span><span class="p">,:]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">clusterAssment</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">clusterAssment</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="n">bestCentToSplit</span><span class="p">)[</span><span class="mi">0</span><span class="p">],:]</span><span class="o">=</span> <span class="n">bestClustAss</span><span class="c1">#reassign new clusters, and SSE</span>
    <span class="k">return</span> <span class="n">mat</span><span class="p">(</span><span class="n">centList</span><span class="p">),</span> <span class="n">clusterAssment</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When I run the below cell it loops forever and never finishes. I went ahead and compelted the other probelms with the base Kmeans though it&#39;s not utilizing the cosine similarity as the distance measure.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[&#160;]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#kmeans model</span>
<span class="n">kMeans</span><span class="p">(</span><span class="n">terms_train</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[51]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Create kmeans model and fit to training set</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">km</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
<span class="n">km_model</span> <span class="o">=</span> <span class="n">km</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">terms_train</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[54]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Create dataframe from clusters</span>
<span class="n">cluster_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">terms_train</span><span class="p">)</span>
<span class="n">cluster_df</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">km_model</span><span class="o">.</span><span class="n">labels_</span>

<span class="c1">#Print size of each cluster</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="n">i</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>1995
1
2
1
1
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[108]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Get frequency and index</span>
<span class="n">top_5_0</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">top_5_1</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">top_5_2</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">top_5_3</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="n">top_5_4</span> <span class="o">=</span> <span class="n">cluster_df</span><span class="p">[</span><span class="n">cluster_df</span><span class="o">.</span><span class="n">cluster</span> <span class="o">==</span> <span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="c1">#Create df for each cluster and join to terms df</span>
<span class="n">top_0_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_0</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_0</span><span class="p">)})</span>
<span class="n">top_1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_1</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_1</span><span class="p">)})</span>
<span class="n">top_2_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_2</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_2</span><span class="p">)})</span>
<span class="n">top_3_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_3</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_3</span><span class="p">)})</span>
<span class="n">top_4_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;index&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_4</span><span class="o">.</span><span class="n">index</span><span class="p">),</span> <span class="s1">&#39;frequency&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">top_5_4</span><span class="p">)})</span>

<span class="c1">#Create index column in terms df</span>
<span class="n">terms</span><span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">terms</span><span class="o">.</span><span class="n">index</span>

<span class="c1">#Merge dataframes</span>
<span class="n">top_0_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">top_0_df</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
<span class="n">top_1_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">top_1_df</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
<span class="n">top_2_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">top_2_df</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
<span class="n">top_3_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">top_3_df</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>
<span class="n">top_4_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">top_4_df</span><span class="p">,</span> <span class="n">terms</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">top_0_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top_1_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top_2_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top_3_df</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">top_4_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>   index  frequency     term
0   7895     2149.0  subject
1   5795     1541.0       on
2   9129     1266.0    write
3   3345     1068.0      god
4   3266      953.0      get
   index  frequency term
0    547    11146.0   ax
1   4982      800.0  max
2   6183       41.0   pl
3    442       17.0  asq
4   6534       11.0   qq
   index  frequency term
0    547     8395.0   ax
1   4982      610.0  max
2   6183      122.0   pl
3   9062       67.0   wm
4   3302       55.0  giz
   index  frequency term
0    547     7675.0   ax
1   4982      559.0  max
2   6183       58.0   pl
3   3302       20.0  giz
4    501       10.0   au
   index  frequency term
0    547     9629.0   ax
1   4982      695.0  max
2   6183      105.0   pl
3   3302       46.0  giz
4   6534       25.0   qq
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4>Problem 2d<a rel="noopener" class="anchor-link" href="#Problem-2d">&#182;</a></h4><p>Using the cluster assignments from Kmeans clustering, compare your 5 clusters to the 5 pre-assigned
classes by computing the Completeness and Homogeneity values.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&#160;[114]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight hl-ipython3"><pre><span></span><span class="c1">#Predict training</span>
<span class="n">train_preds</span> <span class="o">=</span> <span class="n">km_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">terms_train</span><span class="p">)</span>

<span class="c1">#Homogeneity and completeness values</span>
<span class="n">hcv</span> <span class="o">=</span> <span class="n">homogeneity_completeness_v_measure</span><span class="p">(</span><span class="n">train_preds</span><span class="p">,</span> <span class="n">label_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;homogeneity: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hcv</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;completeness: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">hcv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>homogeneity: 0.19490056025800703
completeness: 0.002519824241950802
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<hr/>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h5>Problem 2e<a rel="noopener" class="anchor-link" href="#Problem-2e">&#182;</a></h5><p>Finally, using your cluster assignments as class labels, categorize each of the documents in the 20%
set-aside data into each of the appropriate cluster. Your categorization should be based on Cosine
similarity between each test document and cluster centroids. For each test document show the predicted
class label as well as Cosine similarity to the corresponding cluster.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Skipping this since the cosine similarity is a major part of it and I couldn&#39;t get the kmeans function working.</p>

</div>
</div>
</div>
    </div>
  </div>


 



<script type="text/javascript" src="/d2l/common/math/MathML.js?v=20.20.1.19961-324 "></script><script type="text/javascript">document.addEventListener('DOMContentLoaded', function() { D2LMathML.DesktopInit('https://s.brightspace.com/lib/mathjax/2.6.1/MathJax.js?config=MML_HTMLorMML','https://s.brightspace.com/lib/mathjax/2.6.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML'); });</script></body></html>